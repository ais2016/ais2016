---
layout: post
title: Права доступа и файловые системы
---

# Пользователи и права доступа
## Пользователи
Список пользователей - в /etc/passwd

Формат:
имя:x:UID:GID:некоторое текстовое описание:домашняя директория:shell
UID - 0...65535 - уникальный идентификатор пользователя
GID - 0...65535 - уникальный идентификатор группы пользователя
Домашняя директория - каталог, где хранятся файлы пользователя
(/home/имя)
shell - оболочка по-умолчанию (обычно /bin/sh, /bin/bash)

useradd - команда на добавление пользователя
usermod - модификация
userdel - удаление

passwd - установить пароль пользователю
без аргументов - текущему пользователю
passwd имя - пользователю имя

Пароли хранятся в /etc/shadow

## Группы
/etc/group
groupadd, groupmod, groupdel

# Права доступа

## Типы прав
r - Read - чтение
w - Write - запись
x - eXecute - запуск

Права могут назначаться отдельно для:
1. Владельца файла (u)
2. Группы-владельца файла (g)
3. Все остальные (o)

Все три сразу - All (a)

chmod - команда, задающая права доступа
chmod u+w имя_файла - дать владельцу право на запись
chmod a+x имя_файла

+ - дать право
- - забрать право
= - оставить неизменным

chmod ug+rw - дать пользователю и группе право на чтение и запись

На самом деле права - это 3 восьмеричных цифры

rwx - последовательность битов
x = 1
w = 2
r = 4

rwx rwx rwx
первая тройка - для владельца, вторая для группы, третья для остальных

755
7 - rwx - для владельца на запись/чтение/исполнение
5 - rx - для группы на чтение/исполнение
5 - rx - для остальных на чтение/исполнение

chmod 755 /usr/bin/my_program - права на исполнение и чтение для всех,
  для владельца ещё и на запись
  
## SUID, SGID и Sticky bit
SUID, SGID - ставятся на исполнимые файлы
если стоят, то файл запускается с правами владельца
В основном используется чтобы дать простому юзеру право запускать
системные программы, работающие только из-под root

chmod u+s - ставим SUID
chmod g+s - ставим SGID

chown - изменить владельца файла
chown user:group <имя_файла>

Sticky bit - ставится на директории
если стоит, то пользователь может удалять в директории только свои
файлы
Sticky bit на файлы - сохранять программу в памяти после выполнения
  (ныне не используется)

# Файловая система
Файл - область на диске, имеющая имя
Файловая система - способ организовать хранение файлов

## Свойства файла
Имя файла - набор допустимых символов (почти все кроме слэшей)
Владелец файла и группа файла (2 16-битных числа, указывающих на 
  UID и GID)
Права доступа (rwx etc)
SUID, SGID и sticky bit
Время создания файла, время модификации файла, 
время последнего доступа файла, время последнего удаления файла.
Текущий размер файла.
Число блоков, занимаемых файлом.
Тип файла.

## Тип файлов
1. Обычный файл (просто текстовый или бинарный массив)
2. Каталог (хранит список файлов, которые в нем находятся)
3. Файл последовательного устройства (последовательный порт)
  /dev/zero - файл, из которого можно прочитать любое количество 0
  /dev/null - файл, куда можно записать любое количество чего угодно
  /dev/random - можно читать случайные байты

4. Файл блочного устройства.
5. Именованные каналы (named pipes) (mkfifo - создание канала)
6. Сокеты.
7. Символические ссылки (ссылка на файл, с которой можно работать,
   будто это и есть сам файл) (ln -s файл ссылка - создать)

## Жесткие ссылки
Работают на уровне файловой системы
Новое вхождение в файловую систему, указывающее на те же блоки,
которые занимает другой файл.
Создание: ln файл ссылка

## Swap
В linux swap - это отдельный раздел
mkswap /dev/<имя блочного устройства>
swapon /dev/<имя блочного устройства>
swapoff - отключение свопа

cat /proc/swaps - посмотреть текущие свап-устройства

## Файловые системы в linux
ext4 - самая распространенная
reiserfs - была очень перспективной
xfs

jffs, yaffs, cramfs - специализированные ФС для встраиваемых 
  устройств

mkfs.<имя файловой системы>
mkfs.ext4 /dev/<имя_устройства>
mkfs.ext4 /dev/sda

### Монтирование файловых систем
Монтирование - это процесс привязывания одной файловой системы
  к другой
  
mount /dev/sda /mnt - смонтировать ФС на устройстве /dev/sda
  в каталог /mnt
  
umount /mnt - размонтировать

Устройства жестких дисков - /dev/sd[a..z]
Разделы жестких дисков - /dev/sd[a..z][0..N]
Раздел жесткого диска - отдельная часть диска, выступающая
  отдельным накопителем. На каждом разделе может быть своя ФС.

Для управления разделами используется команда fdisk.
